<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moodify â€” Mood to Music</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Dark mode toggle button -->
  <button id="toggleDarkMode" style="position:fixed; top:16px; right:16px; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; z-index:1000;">
    ğŸŒ™ Dark Mode
  </button>

  <main class="app">
    <header>
      <div class="logo">â™ª</div>
      <div>
        <h1>Moodify</h1>
        <p class="lead">Type or speak how you feel â€” weâ€™ll suggest music that fits your vibe.</p>
      </div>
    </header>

    <section>
      <div class="input-area">
        <textarea id="text" placeholder="Type something like: 'I'm feeling really happy today!'"></textarea>

        <div class="side">
          <button class="icon" id="micBtn" title="Speak (voice input)">ğŸ¤</button>
          <button class="primary" id="analyzeBtn">Analyze Mood ğŸ§</button>
        </div>
      </div>
      <div class="add-jam-section">
      <h3>Add a Jam ğŸµ</h3>
        <div class="jam-inputs">
        <input type="text" id="jamMood" placeholder="Mood (happy, sad, calm...)" />
        <input type="text" id="jamURL" placeholder="Spotify Playlist or Track URL" />
        </div>
        <button id="addJamBtn" class="primary">Add Jam</button>
        <div id="jamFeedback" class="jam-feedback"></div>
        </div>



      <div id="result" class="result fade-in" style="display:none;">
        <!-- JS will populate this area -->
      </div>

      <div class="small">Tip: Try a short sentence describing your feelings, or use the mic to speak.</div>
    </section>

    <footer>
      Built with â¤ï¸ â€” use public Spotify playlists for demo. No login required.
    </footer>
  </main>

  <script>
    // Helper: show a result block
    function showResult(mood, emoji, playlistUrl) {
      const r = document.getElementById('result');
      r.style.display = 'flex';

      let cls = 'mood-neutral';
      if (mood.toLowerCase() === 'happy') cls = 'mood-happy';
      else if (mood.toLowerCase() === 'calm') cls = 'mood-calm';
      else if (mood.toLowerCase() === 'sad') cls = 'mood-sad';

      r.innerHTML = `
        <div class="mood-badge ${cls}">
          <div class="mood-emoji">${emoji}</div>
          <div>${mood}</div>
        </div>
        <div class="mood-info">
          <h3>Playlist suggestion</h3>
          <div>Hereâ€™s a playlist that matches your mood â€” open in Spotify to listen.</div>
          <a href="${playlistUrl}" target="_blank" rel="noopener">ğŸ¶ Open on Spotify</a>
        </div>
      `;
    }

    // Map mood to default emoji and playlist
    function fallbackMapping(mood) {
      mood = mood.toLowerCase();
      if (mood.includes('happy')) return {emoji:'ğŸ˜„', url:'https://open.spotify.com/playlist/37i9dQZF1DXdPec7aLTmlC'};
      if (mood.includes('calm') || mood.includes('relax')) return {emoji:'ğŸ˜Œ', url:'https://open.spotify.com/playlist/37i9dQZF1DWU0ScTcjJBdj'};
      if (mood.includes('sad') || mood.includes('lonely')) return {emoji:'ğŸ˜¢', url:'https://open.spotify.com/playlist/7ABD15iASBIpPP5uJ5awvq'};
      return {emoji:'ğŸ™‚', url:'https://open.spotify.com/playlist/37i9dQZF1DX4WYpdgoIcn6'};
    }

    // Analyze text
    async function analyzeText(text) {
      try {
        const resp = await fetch('/analyze', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ text })
        });

        if (!resp.ok) {
          const fallback = fallbackMapping('neutral');
          showResult('Neutral', fallback.emoji, fallback.url);
          return;
        }

        const data = await resp.json();
        const mood = data.mood || 'Neutral';
        const playlist = data.playlist || fallbackMapping(mood).url;
        const emoji = data.emoji || fallbackMapping(mood).emoji;
        showResult(mood, emoji, playlist);

      } catch (err) {
        console.error(err);
        const fallback = fallbackMapping('neutral');
        showResult('Neutral', fallback.emoji, fallback.url);
      }
    }

    // UI handlers
    document.getElementById('analyzeBtn').addEventListener('click', () => {
      const txt = document.getElementById('text').value.trim();
      if (!txt) { alert('Please type something or use the mic to speak.'); return; }
      analyzeText(txt);
    });

    const micBtn = document.getElementById('micBtn');
    micBtn.addEventListener('click', () => startVoiceInput());

    function startVoiceInput() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) { alert('Voice input not supported.'); return; }

      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      micBtn.disabled = true;
      micBtn.textContent = 'ğŸ™ï¸...';

      recognition.start();

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('text').value = transcript;
        analyzeText(transcript);
      };

      recognition.onend = () => { micBtn.disabled = false; micBtn.textContent = 'ğŸ¤'; };
      recognition.onerror = (err) => { console.error(err); micBtn.disabled = false; micBtn.textContent = 'ğŸ¤'; };
    }

    // Dark mode toggle
    const toggleBtn = document.getElementById('toggleDarkMode');
    toggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      toggleBtn.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode';
    });

  </script>
</body>
</html>
